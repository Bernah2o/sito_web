{% extends "admin/base.html" %}

{% block title %}Cambiar Contraseña{% endblock %}

{% block content %}
<div class="dh2o-admin-header">
    <h1><i class="fas fa-key"></i> Cambiar Contraseña</h1>
    <p>Actualiza tu contraseña de acceso al panel de administración</p>
</div>

<div class="dh2o-admin-content">
    <div class="dh2o-card">
        <div class="dh2o-card-header">
            <h3><i class="fas fa-shield-alt"></i> Seguridad de la Cuenta</h3>
        </div>
        <div class="dh2o-card-body">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="dh2o-alert dh2o-alert-{{ 'danger' if category == 'error' else 'success' }}">
                            <i class="fas fa-{{ 'exclamation-triangle' if category == 'error' else 'check-circle' }}"></i>
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <form method="POST" class="dh2o-form">
                <div class="dh2o-form-row">
                    <div class="dh2o-form-group">
                        <label for="current_password">
                            <i class="fas fa-lock"></i>
                            Contraseña Actual
                        </label>
                        <div class="dh2o-password-input">
                            <input type="password" id="current_password" name="current_password" required>
                            <button type="button" class="dh2o-toggle-password" onclick="togglePassword('current_password')">
                                <i class="fas fa-eye" id="current_password-eye"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="dh2o-form-row">
                    <div class="dh2o-form-group">
                        <label for="new_password">
                            <i class="fas fa-key"></i>
                            Nueva Contraseña
                        </label>
                        <div class="dh2o-password-input">
                            <input type="password" id="new_password" name="new_password" required minlength="6">
                            <button type="button" class="dh2o-toggle-password" onclick="togglePassword('new_password')">
                                <i class="fas fa-eye" id="new_password-eye"></i>
                            </button>
                        </div>
                        <small class="dh2o-form-help">Mínimo 6 caracteres</small>
                    </div>
                </div>

                <div class="dh2o-form-row">
                    <div class="dh2o-form-group">
                        <label for="confirm_password">
                            <i class="fas fa-check-double"></i>
                            Confirmar Nueva Contraseña
                        </label>
                        <div class="dh2o-password-input">
                            <input type="password" id="confirm_password" name="confirm_password" required minlength="6">
                            <button type="button" class="dh2o-toggle-password" onclick="togglePassword('confirm_password')">
                                <i class="fas fa-eye" id="confirm_password-eye"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="dh2o-form-actions">
                    <button type="submit" class="dh2o-btn dh2o-btn-primary">
                        <i class="fas fa-save"></i>
                        Cambiar Contraseña
                    </button>
                    <a href="{{ url_for('admin.dashboard') }}" class="dh2o-btn dh2o-btn-secondary">
                        <i class="fas fa-times"></i>
                        Cancelar
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Consejos de Seguridad -->
    <div class="dh2o-card">
        <div class="dh2o-card-header">
            <h3><i class="fas fa-lightbulb"></i> Consejos de Seguridad</h3>
        </div>
        <div class="dh2o-card-body">
            <div class="dh2o-security-tips">
                <div class="dh2o-tip">
                    <i class="fas fa-check-circle text-success"></i>
                    <span>Usa al menos 8 caracteres</span>
                </div>
                <div class="dh2o-tip">
                    <i class="fas fa-check-circle text-success"></i>
                    <span>Incluye mayúsculas y minúsculas</span>
                </div>
                <div class="dh2o-tip">
                    <i class="fas fa-check-circle text-success"></i>
                    <span>Agrega números y símbolos</span>
                </div>
                <div class="dh2o-tip">
                    <i class="fas fa-check-circle text-success"></i>
                    <span>No uses información personal</span>
                </div>
                <div class="dh2o-tip">
                    <i class="fas fa-check-circle text-success"></i>
                    <span>Cambia tu contraseña regularmente</span>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.dh2o-password-input {
    position: relative;
    display: flex;
    align-items: center;
}

.dh2o-password-input input {
    flex: 1;
    padding-right: 45px;
}

.dh2o-toggle-password {
    position: absolute;
    right: 10px;
    background: none;
    border: none;
    color: #666;
    cursor: pointer;
    padding: 5px;
    border-radius: 3px;
    transition: color 0.3s ease;
}

.dh2o-toggle-password:hover {
    color: #008037;
}

.dh2o-security-tips {
    display: grid;
    gap: 10px;
}

.dh2o-tip {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 0;
}

.dh2o-tip i {
    color: #28a745;
}

.text-success {
    color: #28a745 !important;
}

.dh2o-form-help {
    color: #666;
    font-size: 0.875rem;
    margin-top: 5px;
    display: block;
}
</style>

<script>
function togglePassword(fieldId) {
    const field = document.getElementById(fieldId);
    const eye = document.getElementById(fieldId + '-eye');
    
    if (field.type === 'password') {
        field.type = 'text';
        eye.classList.remove('fa-eye');
        eye.classList.add('fa-eye-slash');
    } else {
        field.type = 'password';
        eye.classList.remove('fa-eye-slash');
        eye.classList.add('fa-eye');
    }
}

// Validación en tiempo real
document.getElementById('confirm_password').addEventListener('input', function() {
    const newPassword = document.getElementById('new_password').value;
    const confirmPassword = this.value;
    
    if (confirmPassword && newPassword !== confirmPassword) {
        this.setCustomValidity('Las contraseñas no coinciden');
        this.style.borderColor = '#dc3545';
    } else {
        this.setCustomValidity('');
        this.style.borderColor = '';
    }
});

document.getElementById('new_password').addEventListener('input', function() {
    const confirmPassword = document.getElementById('confirm_password');
    if (confirmPassword.value) {
        confirmPassword.dispatchEvent(new Event('input'));
    }
});
</script>
{% endblock %}